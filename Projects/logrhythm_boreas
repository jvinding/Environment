CMS_SERVICE_NAME=content-management-svc
boreas() {
    local component=${1:-}
    cd $PROJECT_DIR/boreas
    if [ -n "$component" ]; then
        cd "./components/${component}-parent/${component}"
    fi
}

boreas_cms() {
    boreas "${CMS_SERVICE_NAME}"
}

boreas_stop() {
    boreas
    mvn clean
}

## Helpers

boreas_grpc_build() {
    local component=${1:-}
    if [ -z "$component" ]; then
        echo "must specify a component" >&2
        exit 1
    fi
    boreas
    mvn install -pl ":${component}-grpc-client" -am
}

boreas_component_test() {
    local component=${1:-}
    if [ -z "$component" ]; then
        echo "must specify a component" >&2
        exit 1
    fi
    boreas
    mvn compile test -pl ":${component}" -am
}

boreas_component_code_coverage() {
    local component=${1:-}
    if [ -z "$component" ]; then
        echo "must specify a component" >&2
        exit 1
    fi
    boreas
    mvn test jacoco:report -pl ":${component}" -am
    if [ -d "components/${component}-parent" ]; then
        open "components/${component}-parent/${component}/target/site/jacoco/index.html"
    else
        open "components/${component}/target/site/jacoco/index.html"
    fi
}

## CMS

boreas_cms_verify() {
    boreas
    mvn -B -s infrastructure/maven/settings.xml -Pcontinuous-integration --also-make --also-make-dependents test verify -pl ":${CMS_SERVICE_NAME}"
}

boreas_cms_grpc_build() {
    boreas_grpc_build $CMS_SERVICE_NAME
}

boreas_cms_build() {
    boreas
    mvn compile -pl ":${CMS_SERVICE_NAME} -am
}

boreas_cms_test() {
    boreas_component_test "${CMS_SERVICE_NAME}
}

boreas_cms_start() {
    boreas
    mvn compile quarkus:dev -pl ":${CMS_SERVICE_NAME}" -am
}

boreas_cms_code_coverage() {
    boreas_component_code_coverage "${CMS_SERVICE_NAME}"
}

boreas_super_clean() {
    boreas
    mvn clean -DpurgeVolumes
}

## DB

boreas_psql() {
    docker exec -it boreas-local_postgres_1 /usr/bin/psql -U postgres -h localhost
}

boreas_stop_all_but_postgres() {
    docker ps -a | grep -v postgres | grep -v "CONTAINER ID" | awk '{print $1}' | xargs docker stop
}
